<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ’° Advanced Loan Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-calculator"></i> Advanced Loan Calculator</h1>
            <p class="subtitle">Complete loan analysis with amortization, prepayment, and comparison tools</p>
        </div>
        
        <!-- Two-column layout -->
        <div class="two-column-layout">
            <!-- Left Column: Main Calculator -->
            <div class="left-column">
                <div class="section main-calculator">
                    <h2><i class="fas fa-calculator"></i> Loan Calculator</h2>
                    
                    <div class="loan-type-selector">
                        <div class="input-group">
                            <label for="type"><i class="fas fa-home"></i> Loan Type:</label>
                            <select id="type" onchange="toggleLoanInputs()" class="loan-type-dropdown">
                                <option value="fixed">Fixed-rate</option>
                                <option value="variable">Variable-rate</option>
                                <option value="interest_only">Interest-only</option>
                                <option value="balloon">Balloon Payment</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="calculator-grid">
                        <!-- Column 1 -->
                        <div class="calculator-column">
                            <div class="input-group">
                                <label for="principal"><i class="fas fa-dollar-sign"></i> Loan Amount ($)</label>
                                <input id="principal" type="number" min="1000" step="1000" value="100000" placeholder="100,000">
                            </div>
                            
                            <div class="input-group">
                                <label for="years"><i class="fas fa-calendar-alt"></i> Loan Term (Years)</label>
                                <input id="years" type="number" min="1" max="40" step="1" value="30" placeholder="30">
                            </div>
                            
                            <div class="input-group" id="fixedRateGroup">
                                <label for="rate"><i class="fas fa-percentage"></i> Interest Rate (%)</label>
                                <input id="rate" type="number" min="0" max="20" step="0.1" value="5" placeholder="5.0">
                            </div>
                            
                            <div class="input-group">
                                <label for="fees"><i class="fas fa-file-invoice-dollar"></i> Fees ($)</label>
                                <input id="fees" type="number" min="0" step="100" value="0" placeholder="0">
                                <small>Origination fees, points, etc.</small>
                            </div>
                        </div>
                        
                        <!-- Column 2 -->
                        <div class="calculator-column">
                            <div class="input-group input-hidden" id="variableGroup">
                                <label for="variableRates"><i class="fas fa-chart-line"></i> Variable Rates (%)</label>
                                <input id="variableRates" type="text" placeholder="4,4.5,5,5.5">
                                <small>Comma-separated annual rates</small>
                            </div>
                            
                            <div class="input-group input-hidden" id="interestOnlyGroup">
                                <label for="interestOnlyYears"><i class="fas fa-clock"></i> Interest-Only Period (Years)</label>
                                <input id="interestOnlyYears" type="number" min="0" max="30" step="1" value="0" placeholder="0">
                                <small>0 = entire term</small>
                            </div>
                            
                            <div class="input-group input-hidden" id="balloonGroup">
                                <label for="balloonPercent"><i class="fas fa-money-check-alt"></i> Balloon Payment (%)</label>
                                <input id="balloonPercent" type="number" min="0" max="100" step="1" value="20" placeholder="20">
                            </div>
                            
                            <div class="input-group">
                                <label for="startDate"><i class="fas fa-calendar-day"></i> Start Date</label>
                                <input id="startDate" type="date" value="">
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button onclick="calculate()" class="calculate-btn">
                            <i class="fas fa-calculator"></i> Calculate Loan
                        </button>
                        <button onclick="calculateAPR()" class="apr-btn">
                            <i class="fas fa-percentage"></i> Calculate True APR
                        </button>
                    </div>
                    
                    <div id="result" class="result-summary"></div>
                    
                    
                    
                    <div id="scheduleContainer" style="display:none;" class="schedule-container">
                        <h3><i class="fas fa-table"></i> Amortization Schedule</h3>
                        <div class="table-container">
                            <table id="schedule" class="schedule-table"></table>
                        </div>
                        <div class="export-options">
                            <button onclick="exportToCSV()" class="export-btn">
                                <i class="fas fa-file-csv"></i> Export CSV
                            </button>
                            <button onclick="exportToHTML()" class="export-btn html-btn">
                                <i class="fas fa-file-code"></i> Export HTML
                            </button>
                            <button onclick="exportToText()" class="export-btn text-btn">
                                <i class="fas fa-file-alt"></i> Export Text
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Analysis Tools -->
            <div class="right-column">
                <div class="analysis-tools">
                    <h2><i class="fas fa-chart-line"></i> Analysis Tools</h2>
                    
                    <!-- Tool Tabs -->
                    <div class="tool-tabs">
                        <button class="tab-button active" onclick="openToolTab('compare-tab')">
                            <i class="fas fa-balance-scale"></i> Compare
                        </button>
                        <button class="tab-button" onclick="openToolTab('sensitivity-tab')">
                            <i class="fas fa-sliders-h"></i> Sensitivity
                        </button>
                        <button class="tab-button" onclick="openToolTab('affordability-tab')">
                            <i class="fas fa-hand-holding-usd"></i> Affordability
                        </button>
                        <button class="tab-button" onclick="openToolTab('prepayment-tab')">
                            <i class="fas fa-forward"></i> Prepayment
                        </button>
                        <button class="tab-button" onclick="openToolTab('refinance-tab')">
                            <i class="fas fa-exchange-alt"></i> Refinance
                        </button>
                        <button class="tab-button" onclick="openToolTab('tax-tab')">
                            <i class="fas fa-receipt"></i> Tax
                        </button>
                    </div>
                    
                    <!-- Tool Content -->
                    <div class="tool-content">
                        <!-- Compare Tab -->
                        <div id="compare-tab" class="tab-content active">
                            <h3><i class="fas fa-balance-scale"></i> Loan Comparison</h3>
                            <div class="comparison-inputs">
                                <div class="loan-offer" id="loan-offer-1">
                                    <div class="offer-header">
                                        <span>Loan Offer 1</span>
                                        <button type="button" onclick="removeLoanOffer(1)" class="remove-btn" style="display:none;">Ã—</button>
                                    </div>
                                    <div class="offer-fields">
                                        <input type="text" placeholder="Bank Name" class="offer-name" value="Bank A">
                                        <input type="number" placeholder="Amount" class="offer-principal" value="100000">
                                        <input type="number" placeholder="Rate %" class="offer-rate" step="0.1" value="5">
                                        <input type="number" placeholder="Years" class="offer-years" value="30">
                                        <input type="number" placeholder="Fees" class="offer-fees" value="0">
                                    </div>
                                </div>
                                
                                <div class="loan-offer" id="loan-offer-2">
                                    <div class="offer-header">
                                        <span>Loan Offer 2</span>
                                        <button type="button" onclick="removeLoanOffer(2)" class="remove-btn">Ã—</button>
                                    </div>
                                    <div class="offer-fields">
                                        <input type="text" placeholder="Bank Name" class="offer-name" value="Bank B">
                                        <input type="number" placeholder="Amount" class="offer-principal" value="100000">
                                        <input type="number" placeholder="Rate %" class="offer-rate" step="0.1" value="4.5">
                                        <input type="number" placeholder="Years" class="offer-years" value="30">
                                        <input type="number" placeholder="Fees" class="offer-fees" value="1000">
                                    </div>
                                </div>
                            </div>
                            <button onclick="addLoanOffer()" class="add-offer-btn">
                                <i class="fas fa-plus"></i> Add Another Offer
                            </button>
                            <button onclick="compareLoans()" class="analysis-btn">
                                <i class="fas fa-chart-bar"></i> Compare Loans
                            </button>
                            <div id="compareResult" class="tool-result"></div>
                        </div>
                        
                        <!-- Sensitivity Tab -->
                        <div id="sensitivity-tab" class="tab-content">
                            <h3><i class="fas fa-sliders-h"></i> Sensitivity Analysis</h3>
                            <div class="input-row">
                                <div class="input-group">
                                    <label for="sensPrincipal">Loan Amount</label>
                                    <input id="sensPrincipal" type="number" value="100000">
                                </div>
                                <div class="input-group">
                                    <label for="sensRate">Base Rate (%)</label>
                                    <input id="sensRate" type="number" value="5" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label for="sensYears">Term (Years)</label>
                                    <input id="sensYears" type="number" value="30">
                                </div>
                            </div>
                            <button onclick="sensitivityAnalysis()" class="analysis-btn">
                                <i class="fas fa-chart-line"></i> Analyze Sensitivity
                            </button>
                            <div id="sensitivityResult" class="tool-result"></div>
                        </div>
                        
                        <!-- Affordability Tab -->
                        <div id="affordability-tab" class="tab-content">
                            <h3><i class="fas fa-hand-holding-usd"></i> Affordability Calculator</h3>
                            <div class="input-row">
                                <div class="input-group">
                                    <label for="income">Monthly Income ($)</label>
                                    <input id="income" type="number" value="5000">
                                </div>
                                <div class="input-group">
                                    <label for="debts">Monthly Debts ($)</label>
                                    <input id="debts" type="number" value="500">
                                </div>
                                <div class="input-group">
                                    <label for="payment">Proposed Payment ($)</label>
                                    <input id="payment" type="number" value="1500">
                                </div>
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label for="housingRatio">Housing Ratio (%)</label>
                                    <input id="housingRatio" type="number" value="28" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label for="totalRatio">Total Debt Ratio (%)</label>
                                    <input id="totalRatio" type="number" value="36" step="0.1">
                                </div>
                            </div>
                            <button onclick="affordabilityAnalysis()" class="analysis-btn">
                                <i class="fas fa-check-circle"></i> Check Affordability
                            </button>
                            <div id="affordabilityResult" class="tool-result"></div>
                        </div>
                        
                        <!-- Prepayment Tab -->
                        <div id="prepayment-tab" class="tab-content">
                            <h3><i class="fas fa-forward"></i> Prepayment Analysis</h3>
                            <div class="input-row">
                                <div class="input-group">
                                    <label for="prepayPrincipal">Loan Amount</label>
                                    <input id="prepayPrincipal" type="number" value="100000">
                                </div>
                                <div class="input-group">
                                    <label for="prepayRate">Interest Rate (%)</label>
                                    <input id="prepayRate" type="number" value="5" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label for="prepayYears">Term (Years)</label>
                                    <input id="prepayYears" type="number" value="30">
                                </div>
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label for="prepaymentAmount">Prepayment Amount ($)</label>
                                    <input id="prepaymentAmount" type="number" value="100">
                                </div>
                                <div class="input-group">
                                    <label for="prepaymentStart">Start Month</label>
                                    <input id="prepaymentStart" type="number" value="1" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="prepaymentFrequency">Frequency</label>
                                    <select id="prepaymentFrequency">
                                        <option value="monthly">Monthly</option>
                                        <option value="yearly">Yearly</option>
                                        <option value="quarterly">Quarterly</option>
                                        <option value="one_time">One-time</option>
                                    </select>
                                </div>
                            </div>
                            <button onclick="prepaymentAnalysis()" class="analysis-btn">
                                <i class="fas fa-calculator"></i> Analyze Prepayment
                            </button>
                            <div id="prepaymentResult" class="tool-result"></div>
                        </div>
                        
                        <!-- Refinance Tab -->
                        <div id="refinance-tab" class="tab-content">
                            <h3><i class="fas fa-exchange-alt"></i> Refinancing Analysis</h3>
                            <div class="input-row">
                                <div class="input-group">
                                    <label for="refinanceBalance">Remaining Balance</label>
                                    <input id="refinanceBalance" type="number" value="150000">
                                </div>
                                <div class="input-group">
                                    <label for="oldRate">Current Rate (%)</label>
                                    <input id="oldRate" type="number" value="6" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label for="remainingYears">Remaining Years</label>
                                    <input id="remainingYears" type="number" value="25">
                                </div>
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label for="newRate">New Rate (%)</label>
                                    <input id="newRate" type="number" value="4.5" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label for="newYears">New Term (Years)</label>
                                    <input id="newYears" type="number" value="30">
                                </div>
                                <div class="input-group">
                                    <label for="closingCosts">Closing Costs</label>
                                    <input id="closingCosts" type="number" value="3000">
                                </div>
                            </div>
                            <div class="input-group">
                                <label>
                                    <input type="checkbox" id="rollCosts"> Roll costs into loan
                                </label>
                            </div>
                            <button onclick="refinancingAnalysis()" class="analysis-btn">
                                <i class="fas fa-calculator"></i> Analyze Refinance
                            </button>
                            <div id="refinanceResult" class="tool-result"></div>
                        </div>
                        
                        <!-- Tax Tab -->
                        <div id="tax-tab" class="tab-content">
                            <h3><i class="fas fa-receipt"></i> Tax Implications</h3>
                            <div class="input-row">
                                <div class="input-group">
                                    <label for="annualInterest">Annual Interest ($)</label>
                                    <input id="annualInterest" type="number" value="8000">
                                </div>
                                <div class="input-group">
                                    <label for="taxRate">Tax Rate (%)</label>
                                    <input id="taxRate" type="number" value="25" step="0.1">
                                </div>
                                <div class="input-group">
                                    <label for="propertyTax">Property Tax ($)</label>
                                    <input id="propertyTax" type="number" value="3000">
                                </div>
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label for="filingStatus">Filing Status</label>
                                    <select id="filingStatus">
                                        <option value="single">Single</option>
                                        <option value="married_joint">Married Joint</option>
                                        <option value="married_separate">Married Separate</option>
                                        <option value="head_of_household">Head of Household</option>
                                    </select>
                                </div>
                            </div>
                            <button onclick="taxAnalysis()" class="analysis-btn">
                                <i class="fas fa-calculator"></i> Calculate Tax Savings
                            </button>
                            <div id="taxResult" class="tool-result"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p><i class="fas fa-info-circle"></i> Developed by Enis Osman, Plovdiv University</p>
            <p class="version">Advanced Loan Calculator</p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>